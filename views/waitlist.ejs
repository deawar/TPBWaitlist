<% include ./partials/success-error-mess %>
<% include ./partials/navbar.ejs %>
<div class="row mt-5">
    <div class="col-md-12 m-auto">
        <div class="card card-body border border-danger">
            <h1 class="text-center mb-6">Current Waitlist</h1>
            <% include ./partials/messages %>
            <div class="card card-body border border-danger">
                <form class="d-flex col-md-8 m-auto" id="search-form" >
                    <input class="form-control me-sm-2 search-input" id="search-id" type="text" placeholder="Search..." data-table="customers-list">
                    <button class="btn btn-secondary my-2 my-sm-0" type="submit"><i class="fa fa-search"></i></button>
                </form>
            </div>
            <div>
                <input type="checkbox" id="showDeletedRows" name="prolang"> Hide Deleted Rows <br/>
                <span id="count">Count: </span>
            </div>
            <div class="table-responsive" style="height: 600px;overflow-y: scroll;">
            <!-- <div class="tableFixHead" style="height: 600px;overflow-y: scroll;"> -->
            <table class="table table-hover table-fix customers-list" id="wltable">
                <thead style="position: sticky;top: 0" class="bg-primary text-white">
                    <tr>
                        <th scope="col">Action</th>
                        <th scope="col">Date Added</th>
                        <th scope="col">Customer Name</th>
                        <th scope="col">Address</th>
                        <th scope="col">Address2</th>
                        <th scope="col">City</th>
                        <th scope="col">State</th>
                        <th scope="col">Zip Code</th>
                        <th scope="col">Pets</th>
                        <th scope="col">Mobile Phone</th>
                        <th scope="col">Other Phone</th>
                        <th scope="col">Facility</th>
                        <th scope="col">Preferred Days</th>
                        <th scope="col">Date Removed</th>
                        <th scope="col">Email</th>
                    </tr>
                </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>

        </div>
    </div>
<!-- Edit/Delete Modal -->
<div class="modal hide fade in" id="editDeleteModal" tabindex="-1" role="dialog" aria-labelledby="editDeleteModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editDeleteModalLabel">Edit/Delete Row</h5>
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <!-- Form for editing Row -->
          <form class="form" id="editCustomer" action="/waitlist/update/" method="PATCH">
            <div class="form-group">
                <label for="name">Customer Name</label>
                <input 
                    type="name"
                    id="customer"
                    name="customer"
                    class="form-control"
                    placeholder="Edit Name"
                    autocomplete="given-name" 
                    autofocus 
                    required
                    value="<%= typeof name != 'undefined' ? name : '' %>"
                />
            </div>
            <div class="form-group">
                <label for="phone">Mobile Phone</label>
                <input
                    type="tel"
                    id="phone_mobile"
                    name="phone_mobile"
                    class="form-control"
                    placeholder="Enter Phone number"
                    autofocus 
                    required
                    value="<%= typeof tel != 'undefined' ? tel : '' %>"
                />
            </div>
            <div class="form-group">
                <label for="phone">Phone Other(optional)</label>
                <input
                    type="tel"
                    id="phone_other"
                    name="phone_other"
                    class="form-control"
                    placeholder="Enter Phone number"
                    autocomplete="tel" 
                    autofocus
                    value="<%= typeof tel != 'undefined' ? tel : '' %>"
                />
            </div>
            <div class="form-group">
                <label for="address">Address</label>
                <input 
                    type="address"
                    id="address" 
                    name="address"
                    class="form-control"
                    autocomplete="address" 
                    autofocus 
                    required
                    value="<%= typeof address != 'undefined' ? address : '' %>"
                />
            </div>
            <div class="form-group">
                <label for="address2">Address 2</label>
                <input 
                    type="address"
                    id="address2" 
                    name="address2"
                    class="form-control"
                    autocomplete="address-line2" 
                    autofocus
                    value="<%= typeof address2 != 'undefined' ? address2 : '' %>"
                />
            </div>
            <div class="form-group">
                <label for="zip"></label>Zip Code</label>
                <input 
                    type="zip" 
                    id="zip" 
                    name="zip" 
                    class="form-control"
                    autocomplete="zipcode"
                    autofocus
                    required
                    value="<%= typeof zip != 'undefined' ? zip : '' %>"
                />
            </div>
            <div class="form-group">
                <label for="city">City</label>
                <input type="city"
                    id="city" 
                    name="city" 
                    class="form-control"
                    autocomplete="city" 
                    autofocus 
                    required
                    value="<%= typeof city != 'undefined' ? city : '' %>"
                />
            </div>
            <div class="form-group">
                <label for="state">State</label>
                <select 
                id="state" 
                name="state" 
                class="form-control"
                autocomplete="state" 
                autofocus 
                required
                value="<%= typeof state != 'undefined' ? state : '' %>" 
                onChange="";>
                    <option value="" disabled selected>State...</option>
                    <option value="AL">Alabama</option>
                    <option value="AK">Alaska</option>
                    <option value="AZ">Arizona</option>
                    <option value="AR">Arkansas</option>
                    <option value="CA">California</option>
                    <option value="CO">Colorado</option>
                    <option value="CT">Connecticut</option>
                    <option value="DE">Delaware</option>
                    <option value="DC">District Of Columbia</option>
                    <option value="FL">Florida</option>
                    <option value="GA">Georgia</option>
                    <option value="HI">Hawaii</option>
                    <option value="ID">Idaho</option>
                    <option value="IL">Illinois</option>
                    <option value="IN">Indiana</option>
                    <option value="IA">Iowa</option>
                    <option value="KS">Kansas</option>
                    <option value="KY">Kentucky</option>
                    <option value="LA">Louisiana</option>
                    <option value="ME">Maine</option>
                    <option value="MD">Maryland</option>
                    <option value="MA">Massachusetts</option>
                    <option value="MI">Michigan</option>
                    <option value="MN">Minnesota</option>
                    <option value="MS">Mississippi</option>
                    <option value="MO">Missouri</option>
                    <option value="MT">Montana</option>
                    <option value="NE">Nebraska</option>
                    <option value="NV">Nevada</option>
                    <option value="NH">New Hampshire</option>
                    <option value="NJ">New Jersey</option>
                    <option value="NM">New Mexico</option>
                    <option value="NY">New York</option>
                    <option value="NC">North Carolina</option>
                    <option value="ND">North Dakota</option>
                    <option value="OH">Ohio</option>
                    <option value="OK">Oklahoma</option>
                    <option value="OR">Oregon</option>
                    <option value="PA">Pennsylvania</option>
                    <option value="RI">Rhode Island</option>
                    <option value="SC">South Carolina</option>
                    <option value="SD">South Dakota</option>
                    <option value="TN">Tennessee</option>
                    <option value="TX">Texas</option>
                    <option value="UT">Utah</option>
                    <option value="VT">Vermont</option>
                    <option value="VA">Virginia</option>
                    <option value="WA">Washington</option>
                    <option value="WV">West Virginia</option>
                    <option value="WI">Wisconsin</option>
                    <option value="WY">Wyoming</option>
                </select>
            </div>
            <div class="form-group">
                <label for="email">Email</label>
                <input 
                    type="email"
                    id="email"
                    name="email"
                    class="form-control"
                    placeholder="Enter Email"
                    autocomplete="email" 
                    autofocus 
                    required
                    value="<%= typeof email != 'undefined' ? email : '' %>"
                />
            </div>
            <div class="form-group">
                <label for="pets">Pet names and Breeds(Seperate each with a comma)</label>
                <input 
                    type="pets"
                    id="pets"
                    name="pets"
                    class="form-control"
                    placeholder="Enter Pet Names 'Spot-Beagle, Jimmy-Jack Russel'"
                    autofocus   
                    autocomplete="pets" 
                    required
                    value="<%= typeof pets != 'undefined' ? pets : '' %>"
                />
            </div>
            <div class="form-group" id="allpets">
                <label for="petsNumber">Number of Pets</label>
                <select 
                    type="number"
                    id="petsNumber" 
                    name="petsNumber"
                    class="form-control"
                    autofocus 
                    autocomplete="petsNumber" 
                    required
                    onchange="update()";>
                    <option value="" disabled selected>Total number of pets</option>
                    <option value=1>1</option>
                    <option value=2>2</option>
                    <option value=3>3</option>
                    <option value=4>4</option>
                    <option value=5>5</option>
                    <option value=6>6</option>
                    <option value=7>7</option>
                    <option value=8>8</option>
                    <option value=9>9</option>
                    <option value=10>10</option>
                    <option value=11>11</option>
                    <option value=12>12</option>
                    <option value=13>13</option>
                    <option value=14>14</option>
                    <option value=15>15</option>
                </select>
            <div id="Info"></div>
            <div class="form-group">
                <label for="preferred_days">Preferred Days</label>
                <select 
                    type="preferred_days"
                    id="preferred_days" 
                    name="preferred_days"
                    class="form-control"
                    autofocus 
                    autocomplete="preferred_days" 
                    required
                    multiple
                    onChange="";>
                    <option value="" disabled selected>Hold CTL or CMD to select multiple Day(s)</option>
                    <option value="Monday">Monday</option>
                    <option value="Tuesday">Tuesday</option>
                    <option value="Wednesday">Wednesday</option>
                    <option value="Thursday">Thursday</option>
                    <option value="Friday">Friday</option>
                    <option value="Saturday">Saturday</option>
                    <!-- value="<%= typeof preferred_days != 'undefined' ? preferred_days : '' %>" -->
                </select>
            </div>
                <div class="form-group">
                <label for="deleted_at">Date Removed from Waitlist</label>
                <input 
                    type="deleted_at"
                    id="deleted_at" 
                    name="deleted_at" 
                    class="form-control"
                    autocomplete="deleted_at" 
                    autofocus
                    value="<%= typeof deleted_at != 'undefined' ? deleted_at : '' %>"
                />
            </div>
            <div class="form-group">
                <label for="location">Current Location</label>
                <select 
                    type="location"
                    id="location" 
                    name="location" 
                    class="form-control"
                    autocomplete="location" 
                    autofocus
                    required
                    onChange="";>
                    <option value="" disabled selected>Location...</option>
                    <option value="TPB Trailer">TPB Trailer</option>
                    <option value="TPB Van 1">TPB Van 1</option>
                    <option value="TPB Van 2">TPB Van 2</option>
                    <option value="TPB Van 3">TPB Van 3</option>
                    <option value="TPB Van 4">TPB Van 4</option>
                  </select>
            </div>
            <!-- <button class="btn btn-primary btn-block" type="submit"><i class="fas fa-sign-in-alt"></i> Save Changes</button>
            <button class="btn btn-danger btn-block" href="/waitlist"><i class="fas fa-trash-alt"></i> Cancel</button> -->
          <p>
            If you hit 'Delete' it will NOT remove it from the database 
            only mark the entry as deleted with a datestamp, but this allows us to filter the data.
          </p> 
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" id="btnclose" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" id="savechgBtn">Save changes</button>
          <button type="button" class="btn btn-danger" id="delBtn" data-dismiss="modal">Delete</button>
        </div>
      </div>
    </div>
  </div>
</div>
<% include ./partials/footer.ejs %>
<script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
<script src="../js/waitlistpage.js"></script>
<script>
  // source of this code https://speedysense.com/filter-html-table-using-javascript/
  (function(document) {
            'use strict';

            var TableFilter = (function(myArray) {
                var search_input;

                function _onInputSearch(e) {
                    search_input = e.target;
                    var tables = document.getElementsByClassName(search_input.getAttribute('data-table'));
                    myArray.forEach.call(tables, function(table) {
                        myArray.forEach.call(table.tBodies, function(tbody) {
                            myArray.forEach.call(tbody.rows, function(row) {
                                var text_content = row.textContent.toLowerCase();
                                var search_val = search_input.value.toLowerCase();
                                row.style.display = text_content.indexOf(search_val) > -1 ? '' : 'none';
                            });
                        });
                    });
                }

                return {
                    init: function() {
                        var inputs = document.getElementsByClassName('search-input');
                        myArray.forEach.call(inputs, function(input) {
                            input.oninput = _onInputSearch;
                        });
                    }
                };
            })(Array.prototype);

            document.addEventListener('readystatechange', function() {
                if (document.readyState === 'complete') {
                    TableFilter.init();
                }
            });

        })(document);
    // https://ricardometring.com/getting-the-value-of-a-select-in-javascript
    // Function to build divs for each pet including species, name, breed, sex, age and weight
    function update() {
        const currentForm = document.getElementById("newcustomer");
        const startDiv = document.getElementById("allpets");
        const select = document.getElementById("petsNumber");
        const petvalue = parseInt(select.options[select.selectedIndex].value);
        const allPetInfo = document.getElementById("Info");
        const petInfo = {"petsSpecies":"Species of Pet-Dog/Cat", "petsName":"Pet's Name", "petsSex":"Pet's Gender", "petsBreed":"Pet's Breed-Beagle/Poodle", "petsAge":"Pet's Age in Years", "petsWeight":"Pet's Weight in Lbs."};
        const hr = document.createElement("HR");
        console.log({petvalue});

        //Begin building pet divs
        
            for(let i=0; i < petvalue; i++) {
                //Creates a div element for each pet
                const petDiv = document.createElement('div');
                petDiv.setAttribute('class', 'form-group');
                petDiv.setAttribute('id', 'pet'+ i);
                
                //begin forEach
                //petInfo.forEach(element => {
                
                console.log('Before for value Loop:', petvalue);
                for (let value of Object.keys(petInfo)) {   
                    console.log('in for (let value of Object.values(arr)) loop: ', value);
                    
                    
                    console.log('value of for next i: ', i);
                    let labelid = 'label'+ value + i;
                    //petDiv.setAttribute('id', element+i);
                    let iLabel = document.createElement('Label');
                    if(value === 'petsSex'){
                      // create div and labels for radio buttons
                        const femDiv = document.createElement('div');
                        const malDiv = document.createElement('div');
                        const femLabel = document.createElement('Label');
                        const malLabel = document.createElement('Label');
                        const femInput = document.createElement('INPUT');
                        const malInput = document.createElement('INPUT');

                        // assign div class form-check, id 
                        femDiv.setAttribute('class','form-check');
                        femDiv.setAttribute('id','petsSex0f')
                        malDiv.setAttribute('class','form-check');
                        malDiv.setAttribute('id','petsSex0m')

                        // assign label header
                        iLabel.setAttribute('id', labelid);
                        iLabel.setAttribute('for', value);
                        //let iInput = document.createElement('INPUT');
                        iLabel.setAttribute('class', 'form-check-label');
                        
                        // assign input as radio, give id of pet, name, class and value
                        femInput.setAttribute('class', 'form-check-input');
                        femInput.setAttribute('type', 'radio');
                        femInput.setAttribute('id', i+value+'f');
                        femInput.setAttribute('name', value+i);
                        femInput.setAttribute('value', 'Female');
                        femInput.setAttribute('autofocus', '');
                        femLabel.setAttribute('class','form-check-label');
                        femLabel.setAttribute('for', labelid);

                        femLabel.innerHTML = `<b> Female</b>`;
                        petDiv.appendChild(iLabel);
                        petDiv.appendChild(femDiv);
                        femDiv.appendChild(femInput);
                        femDiv.appendChild(femLabel);

                      // assign input as male label
                        malInput.setAttribute('class', 'form-check-input');
                        malInput.setAttribute('type', 'radio');
                        malInput.setAttribute('id', i+value+'m');
                        malInput.setAttribute('name', value+i);
                        malInput.setAttribute('value', 'Male');
                        malInput.setAttribute('autofocus', '');
                        malLabel.setAttribute('class','form-check-label');
                        malLabel.setAttribute('for', labelid);
                        malLabel.innerHTML = `<b> Male</b>`;
                        //petDiv.appendChild(iLabel);
                        petDiv.appendChild(malDiv);
                        malDiv.appendChild(malInput);
                        malDiv.appendChild(malLabel);

                    } else if(value === 'petsAge' || value === 'petsWeight'){
                        iLabel.setAttribute('id', labelid);
                        iLabel.setAttribute('for', value);
                        let iInput = document.createElement('INPUT');
                        iInput.setAttribute('type', 'number');
                        iInput.setAttribute('id', i+value);
                        iInput.setAttribute('name', value+i);
                        iInput.setAttribute('placeholder', value);

                        iInput.setAttribute('class', 'form-control');
                        iInput.setAttribute('autofocus', '');
                        petDiv.appendChild(iLabel);
                        petDiv.appendChild(iInput);
                    } else {
                        iLabel.setAttribute('id', labelid);
                        iLabel.setAttribute('for', value);
                        let iInput = document.createElement('INPUT');
                        iInput.setAttribute('type', 'text');
                        iInput.setAttribute('id', i+value);
                        iInput.setAttribute('name', value+i);
                        iInput.setAttribute('placeholder', value);
                        iInput.setAttribute('class', 'form-control');
                        iInput.setAttribute('autofocus', '');
                        petDiv.appendChild(iLabel);
                        petDiv.appendChild(iInput);
                    }
                    //iLabel.setAttribute('for', element);

                    console.log('petInfo.', value +  ' is ', petInfo[value]);
                    iLabel.innerHTML = `<b> ${petInfo[value]}</b>`;
                    if(value === 'petsAge') {
                        petDiv.appendChild(hr);
                    };
                    
                    
                }; //forEach loop
                allPetInfo.appendChild(petDiv);
                console.log('i counter: ',i);
                let setHR = document.getElementById('pet'+i);
                console.log({setHR});
                setHR.appendChild(hr);
            }; //for i loop
    };
    update(); 
</script>
